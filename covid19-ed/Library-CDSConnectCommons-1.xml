<?xml version="1.0" encoding="UTF-8"?>
<library xmlns="urn:hl7-org:elm:r1" xmlns:t="urn:hl7-org:elm-types:r1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:fhir="http://hl7.org/fhir" xmlns:qdm43="urn:healthit-gov:qdm:v4_3" xmlns:qdm53="urn:healthit-gov:qdm:v5_3" xmlns:a="urn:hl7-org:cql-annotations:r1">
   <annotation translatorOptions="EnableLocators,DisableListDemotion,DisableListPromotion" xsi:type="a:CqlToElmInfo"/>
   <identifier id="CDS_Connect_Commons_for_FHIRv400" system="http://opencpg.org/fhir/covid19.ed.sc" version="1.0.2"/>
   <schemaIdentifier id="urn:hl7-org:elm" version="r1"/>
   <usings>
      <def localIdentifier="System" uri="urn:hl7-org:elm-types:r1"/>
      <def locator="15:1-15:26" localIdentifier="FHIR" uri="http://hl7.org/fhir" version="4.0.1"/>
   </usings>
   <includes>
      <def locator="18:1-18:54" localIdentifier="FHIRHelpers" path="http://hl7.org/fhir/FHIRHelpers" version="4.0.1"/>
   </includes>
   <codeSystems>
      <def locator="20:1-20:97" name="AIVERSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-verification" accessLevel="Public"/>
      <def locator="21:1-21:94" name="AICLINSTATUS" id="http://terminology.hl7.org/CodeSystem/allergyintolerance-clinical" accessLevel="Public"/>
      <def locator="22:1-22:88" name="CONDVERSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-ver-status" accessLevel="Public"/>
      <def locator="23:1-23:87" name="CONDCLINSTATUS" id="http://terminology.hl7.org/CodeSystem/condition-clinical" accessLevel="Public"/>
   </codeSystems>
   <codes>
      <def locator="24:1-24:92" name="AllergyIntolerance Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="24:60-24:72" name="AIVERSTATUS"/>
      </def>
      <def locator="25:1-25:84" name="AllergyIntolerance Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="25:54-25:67" name="AICLINSTATUS"/>
      </def>
      <def locator="26:1-26:85" name="Condition Confirmed code" id="confirmed" display="Confirmed" accessLevel="Public">
         <codeSystem locator="26:51-26:65" name="CONDVERSTATUS"/>
      </def>
      <def locator="27:1-27:77" name="Condition Active code" id="active" display="Active" accessLevel="Public">
         <codeSystem locator="27:45-27:60" name="CONDCLINSTATUS"/>
      </def>
      <def locator="28:1-28:89" name="Condition Recurrence code" id="recurrence" display="Recurrence" accessLevel="Public">
         <codeSystem locator="28:53-28:68" name="CONDCLINSTATUS"/>
      </def>
      <def locator="29:1-29:80" name="Condition Relapse code" id="relapse" display="Relapse" accessLevel="Public">
         <codeSystem locator="29:47-29:62" name="CONDCLINSTATUS"/>
      </def>
   </codes>
   <statements>
      <def locator="47:1-54:56" name="PeriodToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="48:3-54:56" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="48:6-48:19" xsi:type="IsNull">
                  <operand locator="48:6-48:11" name="period" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="49:5-49:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:DateTime" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="51:5-54:56" xsi:type="If">
               <condition asType="t:Boolean" xsi:type="As">
                  <operand locator="51:8-51:29" xsi:type="IsNull">
                     <operand locator="51:8-51:21" path="start" xsi:type="Property">
                        <source locator="51:8-51:13" name="period" xsi:type="OperandRef"/>
                     </operand>
                  </operand>
               </condition>
               <then locator="52:7-52:56" lowClosed="false" highClosed="true" xsi:type="Interval">
                  <low locator="52:16-52:35" path="value" xsi:type="Property">
                     <source locator="52:16-52:29" path="start" xsi:type="Property">
                        <source locator="52:16-52:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="52:38-52:55" path="value" xsi:type="Property">
                     <source locator="52:38-52:49" path="end" xsi:type="Property">
                        <source locator="52:38-52:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </then>
               <else locator="54:7-54:56" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="54:16-54:35" path="value" xsi:type="Property">
                     <source locator="54:16-54:29" path="start" xsi:type="Property">
                        <source locator="54:16-54:21" name="period" xsi:type="OperandRef"/>
                     </source>
                  </low>
                  <high locator="54:38-54:55" path="value" xsi:type="Property">
                     <source locator="54:38-54:49" path="end" xsi:type="Property">
                        <source locator="54:38-54:43" name="period" xsi:type="OperandRef"/>
                     </source>
                  </high>
               </else>
            </else>
         </expression>
         <operand name="period">
            <operandTypeSpecifier locator="47:41-47:51" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="101:1-105:83" name="RangeToInterval" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="102:3-105:83" xsi:type="If">
            <condition asType="t:Boolean" xsi:type="As">
               <operand locator="102:6-102:18" xsi:type="IsNull">
                  <operand locator="102:6-102:10" name="range" xsi:type="OperandRef"/>
               </operand>
            </condition>
            <then xsi:type="As">
               <operand locator="103:5-103:8" xsi:type="Null"/>
               <asTypeSpecifier xsi:type="IntervalTypeSpecifier">
                  <pointType name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
               </asTypeSpecifier>
            </then>
            <else locator="105:5-105:83" lowClosed="true" highClosed="true" xsi:type="Interval">
               <low locator="105:14-105:46" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="105:37-105:45" path="low" xsi:type="Property">
                     <source locator="105:37-105:41" name="range" xsi:type="OperandRef"/>
                  </operand>
               </low>
               <high locator="105:49-105:82" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="105:72-105:81" path="high" xsi:type="Property">
                     <source locator="105:72-105:76" name="range" xsi:type="OperandRef"/>
                  </operand>
               </high>
            </else>
         </expression>
         <operand name="range">
            <operandTypeSpecifier locator="101:39-101:48" name="fhir:Range" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="115:1-116:63" name="ObservationsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="116:3-116:63" xsi:type="Query">
            <source locator="116:3-116:17" alias="O">
               <expression locator="116:3-116:15" dataType="fhir:Observation" templateId="http://hl7.org/fhir/StructureDefinition/Observation" xsi:type="Retrieve"/>
            </source>
            <where locator="116:19-116:63" xsi:type="Equivalent">
               <operand locator="116:25-116:53" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="116:47-116:52" path="code" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="116:57-116:63" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="115:47-115:60" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="125:1-126:69" name="Verified" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="126:3-126:69" xsi:type="Query">
            <source locator="126:3-126:11" alias="O">
               <expression locator="126:3-126:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="126:13-126:69" xsi:type="In">
               <operand locator="126:19-126:32" path="value" xsi:type="Property">
                  <source locator="126:19-126:26" path="status" scope="O" xsi:type="Property"/>
               </operand>
               <operand locator="126:37-126:69" xsi:type="List">
                  <element locator="126:38-126:44" valueType="t:String" value="final" xsi:type="Literal"/>
                  <element locator="126:47-126:57" valueType="t:String" value="corrected" xsi:type="Literal"/>
                  <element locator="126:60-126:68" valueType="t:String" value="amended" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="125:34-125:50" xsi:type="ListTypeSpecifier">
               <elementType locator="125:39-125:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="134:1-136:102" name="WithUnit" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="135:3-136:102" xsi:type="Query">
            <source locator="135:3-135:11" alias="O">
               <expression locator="135:3-135:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <where locator="136:5-136:102" xsi:type="Or">
               <operand locator="136:11-136:54" xsi:type="Equal">
                  <operand locator="136:11-136:47" path="value" xsi:type="Property">
                     <source locator="136:11-136:41" path="unit" xsi:type="Property">
                        <source locator="136:11-136:36" strict="false" xsi:type="As">
                           <operand locator="136:12-136:18" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="136:23-136:35" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="136:51-136:54" name="Unit" xsi:type="OperandRef"/>
               </operand>
               <operand locator="136:59-136:102" xsi:type="Equal">
                  <operand locator="136:59-136:95" path="value" xsi:type="Property">
                     <source locator="136:59-136:89" path="code" xsi:type="Property">
                        <source locator="136:59-136:84" strict="false" xsi:type="As">
                           <operand locator="136:60-136:66" path="value" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="136:71-136:83" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </source>
                  </operand>
                  <operand locator="136:99-136:102" name="Unit" xsi:type="OperandRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="134:34-134:50" xsi:type="ListTypeSpecifier">
               <elementType locator="134:39-134:49" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="Unit">
            <operandTypeSpecifier locator="134:58-134:63" name="t:String" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="146:1-152:43" name="ObservationLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="147:3-152:43" xsi:type="Query">
            <source locator="147:3-147:11" alias="O">
               <expression locator="147:3-147:9" name="ObsList" xsi:type="OperandRef"/>
            </source>
            <let locator="148:9-148:59" identifier="LookBackInterval">
               <expression locator="148:27-148:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="148:36-148:51" xsi:type="Subtract">
                     <operand locator="148:36-148:40" xsi:type="Now"/>
                     <operand locator="148:44-148:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="148:54-148:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="149:5-152:43" xsi:type="Or">
               <operand locator="149:11-151:79" xsi:type="Or">
                  <operand locator="149:11-150:64" xsi:type="Or">
                     <operand locator="149:11-149:66" xsi:type="In">
                        <operand locator="149:11-149:46" path="value" xsi:type="Property">
                           <source locator="149:11-149:40" strict="false" xsi:type="As">
                              <operand locator="149:12-149:22" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="149:27-149:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="149:51-149:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="150:10-150:64" xsi:type="In">
                        <operand locator="150:10-150:44" path="value" xsi:type="Property">
                           <source locator="150:10-150:38" strict="false" xsi:type="As">
                              <operand locator="150:11-150:21" path="effective" scope="O" xsi:type="Property"/>
                              <asTypeSpecifier locator="150:26-150:37" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="150:49-150:64" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="151:10-151:79" xsi:type="Overlaps">
                     <operand locator="151:10-151:53" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="151:27-151:52" strict="false" xsi:type="As">
                           <operand locator="151:27-151:37" path="effective" scope="O" xsi:type="Property"/>
                           <asTypeSpecifier locator="151:42-151:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="151:64-151:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="152:10-152:43" xsi:type="In">
                  <operand locator="152:10-152:23" path="value" xsi:type="Property">
                     <source locator="152:10-152:17" path="issued" scope="O" xsi:type="Property"/>
                  </operand>
                  <operand locator="152:28-152:43" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="146:45-146:61" xsi:type="ListTypeSpecifier">
               <elementType locator="146:50-146:60" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="146:73-146:87" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="163:1-170:3" name="MostRecent" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="164:3-170:3" xsi:type="Last">
            <source locator="164:8-169:17" xsi:type="Query">
               <source locator="164:8-164:16" alias="O">
                  <expression locator="164:8-164:14" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <sort locator="164:18-169:17">
                  <by locator="164:26-169:17" direction="asc" xsi:type="ByExpression">
                     <expression locator="164:26-169:17" xsi:type="Coalesce">
                        <operand locator="165:5-165:38" path="value" xsi:type="Property">
                           <source locator="165:5-165:32" strict="false" xsi:type="As">
                              <operand locator="165:6-165:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="165:19-165:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="166:5-166:37" path="value" xsi:type="Property">
                           <source locator="166:5-166:31" strict="false" xsi:type="As">
                              <operand locator="166:6-166:14" name="effective" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="166:19-166:30" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="167:5-167:42" path="value" xsi:type="Property">
                           <source locator="167:5-167:36" path="end" xsi:type="Property">
                              <source locator="167:5-167:30" strict="false" xsi:type="As">
                                 <operand locator="167:6-167:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="167:19-167:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="168:5-168:44" path="value" xsi:type="Property">
                           <source locator="168:5-168:38" path="start" xsi:type="Property">
                              <source locator="168:5-168:30" strict="false" xsi:type="As">
                                 <operand locator="168:6-168:14" name="effective" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="168:19-168:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="169:5-169:16" path="value" xsi:type="Property">
                           <source locator="169:5-169:10" name="issued" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="163:36-163:52" xsi:type="ListTypeSpecifier">
               <elementType locator="163:41-163:51" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="177:1-178:52" name="QuantityValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="178:3-178:52" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand locator="178:26-178:51" strict="false" xsi:type="As">
               <operand locator="178:26-178:34" path="value" xsi:type="Property">
                  <source locator="178:26-178:28" name="Obs" xsi:type="OperandRef"/>
               </operand>
               <asTypeSpecifier locator="178:39-178:51" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="177:35-177:45" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="185:1-186:58" name="ConceptValue" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="186:3-186:58" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
            <operand locator="186:25-186:57" strict="false" xsi:type="As">
               <operand locator="186:25-186:33" path="value" xsi:type="Property">
                  <source locator="186:25-186:27" name="Obs" xsi:type="OperandRef"/>
               </operand>
               <asTypeSpecifier locator="186:38-186:57" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="185:34-185:44" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="195:1-202:3" name="FindDate" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="196:3-202:3" xsi:type="Coalesce">
            <operand locator="197:5-197:42" path="value" xsi:type="Property">
               <source locator="197:5-197:36" strict="false" xsi:type="As">
                  <operand locator="197:6-197:18" path="effective" xsi:type="Property">
                     <source locator="197:6-197:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="197:23-197:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="198:5-198:41" path="value" xsi:type="Property">
               <source locator="198:5-198:35" strict="false" xsi:type="As">
                  <operand locator="198:6-198:18" path="effective" xsi:type="Property">
                     <source locator="198:6-198:8" name="Obs" xsi:type="OperandRef"/>
                  </operand>
                  <asTypeSpecifier locator="198:23-198:34" name="fhir:instant" xsi:type="NamedTypeSpecifier"/>
               </source>
            </operand>
            <operand locator="199:5-199:46" path="value" xsi:type="Property">
               <source locator="199:5-199:40" path="end" xsi:type="Property">
                  <source locator="199:5-199:34" strict="false" xsi:type="As">
                     <operand locator="199:6-199:18" path="effective" xsi:type="Property">
                        <source locator="199:6-199:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="199:23-199:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="200:5-200:48" path="value" xsi:type="Property">
               <source locator="200:5-200:42" path="start" xsi:type="Property">
                  <source locator="200:5-200:34" strict="false" xsi:type="As">
                     <operand locator="200:6-200:18" path="effective" xsi:type="Property">
                        <source locator="200:6-200:8" name="Obs" xsi:type="OperandRef"/>
                     </operand>
                     <asTypeSpecifier locator="200:23-200:33" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </source>
            </operand>
            <operand locator="201:5-201:20" path="value" xsi:type="Property">
               <source locator="201:5-201:14" path="issued" xsi:type="Property">
                  <source locator="201:5-201:7" name="Obs" xsi:type="OperandRef"/>
               </source>
            </operand>
         </expression>
         <operand name="Obs">
            <operandTypeSpecifier locator="195:30-195:40" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="210:1-211:72" name="HighestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="211:3-211:72" xsi:type="Max">
            <source locator="211:7-211:71" xsi:type="Query">
               <source locator="211:7-211:15" alias="O">
                  <expression locator="211:7-211:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="211:17-211:71">
                  <expression locator="211:24-211:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="211:47-211:70" strict="false" xsi:type="As">
                        <operand locator="211:47-211:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="211:58-211:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="210:44-210:60" xsi:type="ListTypeSpecifier">
               <elementType locator="210:49-210:59" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="219:1-220:72" name="LowestObservation" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="220:3-220:72" xsi:type="Min">
            <source locator="220:7-220:71" xsi:type="Query">
               <source locator="220:7-220:15" alias="O">
                  <expression locator="220:7-220:13" name="ObsList" xsi:type="OperandRef"/>
               </source>
               <return locator="220:17-220:71">
                  <expression locator="220:24-220:71" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="220:47-220:70" strict="false" xsi:type="As">
                        <operand locator="220:47-220:53" path="value" scope="O" xsi:type="Property"/>
                        <asTypeSpecifier locator="220:58-220:70" name="fhir:Quantity" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </expression>
               </return>
            </source>
         </expression>
         <operand name="ObsList">
            <operandTypeSpecifier locator="219:43-219:59" xsi:type="ListTypeSpecifier">
               <elementType locator="219:48-219:58" name="fhir:Observation" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="231:1-232:61" name="ConditionsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="232:3-232:61" xsi:type="Query">
            <source locator="232:3-232:15" alias="C">
               <expression locator="232:3-232:13" dataType="fhir:Condition" templateId="http://hl7.org/fhir/StructureDefinition/Condition" xsi:type="Retrieve"/>
            </source>
            <where locator="232:17-232:61" xsi:type="Equivalent">
               <operand locator="232:23-232:51" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="232:45-232:50" path="code" scope="C" xsi:type="Property"/>
               </operand>
               <operand locator="232:55-232:61" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="231:45-231:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="240:1-241:68" name="Confirmed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="241:3-241:68" xsi:type="Query">
            <source locator="241:3-241:12" alias="C">
               <expression locator="241:3-241:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="241:14-241:68" xsi:type="Equivalent">
               <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="241:20-241:39" path="verificationStatus" scope="C" xsi:type="Property"/>
               </operand>
               <operand xsi:type="ToConcept">
                  <operand locator="241:43-241:68" name="Condition Confirmed code" xsi:type="CodeRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="240:36-240:50" xsi:type="ListTypeSpecifier">
               <elementType locator="240:41-240:49" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="251:1-254:29" name="ActiveCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="252:3-254:29" xsi:type="Query">
            <source locator="252:3-252:12" alias="C">
               <expression locator="252:3-252:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="253:5-254:29" xsi:type="And">
               <operand locator="253:11-253:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="253:11-253:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="253:30-253:52" name="Condition Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="254:11-254:29" xsi:type="IsNull">
                  <operand locator="254:11-254:21" path="abatement" scope="C" xsi:type="Property"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="251:42-251:56" xsi:type="ListTypeSpecifier">
               <elementType locator="251:47-251:55" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="264:1-268:52" name="ActiveOrRecurring" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="265:3-268:52" xsi:type="Query">
            <source locator="265:3-265:12" alias="C">
               <expression locator="265:3-265:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <where locator="266:5-268:52" xsi:type="Or">
               <operand locator="266:11-267:55" xsi:type="Or">
                  <operand locator="266:11-266:52" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="266:11-266:26" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="266:30-266:52" name="Condition Active code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
                  <operand locator="267:10-267:55" xsi:type="Equivalent">
                     <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="267:10-267:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                     </operand>
                     <operand xsi:type="ToConcept">
                        <operand locator="267:29-267:55" name="Condition Recurrence code" xsi:type="CodeRef"/>
                     </operand>
                  </operand>
               </operand>
               <operand locator="268:10-268:52" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="268:10-268:25" path="clinicalStatus" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="268:29-268:52" name="Condition Relapse code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="264:44-264:58" xsi:type="ListTypeSpecifier">
               <elementType locator="264:49-264:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="278:1-283:49" name="ConditionLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="279:3-283:49" xsi:type="Query">
            <source locator="279:3-279:12" alias="C">
               <expression locator="279:3-279:10" name="CondList" xsi:type="OperandRef"/>
            </source>
            <let locator="280:9-280:59" identifier="LookBackInterval">
               <expression locator="280:27-280:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="280:36-280:51" xsi:type="Subtract">
                     <operand locator="280:36-280:40" xsi:type="Now"/>
                     <operand locator="280:44-280:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="280:54-280:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="281:5-283:49" xsi:type="Or">
               <operand locator="281:11-282:75" xsi:type="Or">
                  <operand locator="281:11-281:62" xsi:type="In">
                     <operand locator="281:11-281:42" path="value" xsi:type="Property">
                        <source locator="281:11-281:36" strict="false" xsi:type="As">
                           <operand locator="281:12-281:18" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="281:23-281:35" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </operand>
                     <operand locator="281:47-281:62" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
                  <operand locator="282:10-282:75" xsi:type="Overlaps">
                     <operand locator="282:10-282:49" name="PeriodToInterval" xsi:type="FunctionRef">
                        <operand locator="282:27-282:48" strict="false" xsi:type="As">
                           <operand locator="282:27-282:33" path="onset" scope="C" xsi:type="Property"/>
                           <asTypeSpecifier locator="282:38-282:48" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </operand>
                     <operand locator="282:60-282:75" name="LookBackInterval" xsi:type="QueryLetRef"/>
                  </operand>
               </operand>
               <operand locator="283:10-283:49" xsi:type="In">
                  <operand locator="283:10-283:29" path="value" xsi:type="Property">
                     <source locator="283:10-283:23" path="recordedDate" scope="C" xsi:type="Property"/>
                  </operand>
                  <operand locator="283:34-283:49" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="278:44-278:58" xsi:type="ListTypeSpecifier">
               <elementType locator="278:49-278:57" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="278:70-278:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="292:1-298:3" name="MostRecentCondition" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="293:3-298:3" xsi:type="Last">
            <source locator="293:8-297:23" xsi:type="Query">
               <source locator="293:8-293:17" alias="C">
                  <expression locator="293:8-293:15" name="CondList" xsi:type="OperandRef"/>
               </source>
               <sort locator="293:19-297:23">
                  <by locator="293:27-297:23" direction="asc" xsi:type="ByExpression">
                     <expression locator="293:27-297:23" xsi:type="Coalesce">
                        <operand locator="294:5-294:34" path="value" xsi:type="Property">
                           <source locator="294:5-294:28" strict="false" xsi:type="As">
                              <operand locator="294:6-294:10" name="onset" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="294:15-294:27" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="295:5-295:38" path="value" xsi:type="Property">
                           <source locator="295:5-295:32" path="end" xsi:type="Property">
                              <source locator="295:5-295:26" strict="false" xsi:type="As">
                                 <operand locator="295:6-295:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="295:15-295:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="296:5-296:40" path="value" xsi:type="Property">
                           <source locator="296:5-296:34" path="start" xsi:type="Property">
                              <source locator="296:5-296:26" strict="false" xsi:type="As">
                                 <operand locator="296:6-296:10" name="onset" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="296:15-296:25" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="297:5-297:22" path="value" xsi:type="Property">
                           <source locator="297:5-297:16" name="recordedDate" xsi:type="IdentifierRef"/>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="CondList">
            <operandTypeSpecifier locator="292:46-292:60" xsi:type="ListTypeSpecifier">
               <elementType locator="292:51-292:59" name="fhir:Condition" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="308:2-309:62" name="ProceduresByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="309:4-309:62" xsi:type="Query">
            <source locator="309:4-309:16" alias="P">
               <expression locator="309:4-309:14" dataType="fhir:Procedure" templateId="http://hl7.org/fhir/StructureDefinition/Procedure" xsi:type="Retrieve"/>
            </source>
            <where locator="309:18-309:62" xsi:type="Equivalent">
               <operand locator="309:24-309:52" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="309:46-309:51" path="code" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="309:56-309:62" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="308:46-308:59" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="317:1-319:38" name="Completed" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="318:3-319:38" xsi:type="Query">
            <source locator="318:3-318:12" alias="P">
               <expression locator="318:3-318:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="319:5-319:38" xsi:type="Equal">
               <operand locator="319:11-319:24" path="value" xsi:type="Property">
                  <source locator="319:11-319:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="319:28-319:38" valueType="t:String" value="completed" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="317:36-317:50" xsi:type="ListTypeSpecifier">
               <elementType locator="317:41-317:49" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="327:1-329:40" name="ProcedureInProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="328:3-329:40" xsi:type="Query">
            <source locator="328:3-328:12" alias="P">
               <expression locator="328:3-328:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="329:5-329:40" xsi:type="Equal">
               <operand locator="329:11-329:24" path="value" xsi:type="Property">
                  <source locator="329:11-329:18" path="status" scope="P" xsi:type="Property"/>
               </operand>
               <operand locator="329:28-329:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="327:46-327:60" xsi:type="ListTypeSpecifier">
               <elementType locator="327:51-327:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="338:1-340:92" name="ProcedurePerformance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="339:3-340:92" xsi:type="Query">
            <source locator="339:3-339:12" alias="P">
               <expression locator="339:3-339:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <where locator="340:5-340:92" xsi:type="Not">
               <operand locator="340:15-340:92" xsi:type="In">
                  <operand locator="340:16-340:29" path="value" xsi:type="Property">
                     <source locator="340:16-340:23" path="status" scope="P" xsi:type="Property"/>
                  </operand>
                  <operand locator="340:34-340:91" xsi:type="List">
                     <element locator="340:35-340:47" valueType="t:String" value="preparation" xsi:type="Literal"/>
                     <element locator="340:50-340:59" valueType="t:String" value="not-done" xsi:type="Literal"/>
                     <element locator="340:62-340:79" valueType="t:String" value="entered-in-error" xsi:type="Literal"/>
                     <element locator="340:82-340:90" valueType="t:String" value="unknown" xsi:type="Literal"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="338:47-338:61" xsi:type="ListTypeSpecifier">
               <elementType locator="338:52-338:60" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="351:1-355:79" name="ProcedureLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="352:3-355:79" xsi:type="Query">
            <source locator="352:3-352:12" alias="P">
               <expression locator="352:3-352:10" name="ProcList" xsi:type="OperandRef"/>
            </source>
            <let locator="353:9-353:59" identifier="LookBackInterval">
               <expression locator="353:27-353:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="353:36-353:51" xsi:type="Subtract">
                     <operand locator="353:36-353:40" xsi:type="Now"/>
                     <operand locator="353:44-353:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="353:54-353:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="354:5-355:79" xsi:type="Or">
               <operand locator="354:11-354:66" xsi:type="In">
                  <operand locator="354:11-354:46" path="value" xsi:type="Property">
                     <source locator="354:11-354:40" strict="false" xsi:type="As">
                        <operand locator="354:12-354:22" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="354:27-354:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     </source>
                  </operand>
                  <operand locator="354:51-354:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
               <operand locator="355:10-355:79" xsi:type="Overlaps">
                  <operand locator="355:10-355:53" name="PeriodToInterval" xsi:type="FunctionRef">
                     <operand locator="355:27-355:52" strict="false" xsi:type="As">
                        <operand locator="355:27-355:37" path="performed" scope="P" xsi:type="Property"/>
                        <asTypeSpecifier locator="355:42-355:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </operand>
                  <operand locator="355:64-355:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="351:44-351:58" xsi:type="ListTypeSpecifier">
               <elementType locator="351:49-351:57" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="351:70-351:84" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="364:1-369:3" name="MostRecentProcedure" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="365:3-369:3" xsi:type="Last">
            <source locator="365:8-368:45" xsi:type="Query">
               <source locator="365:8-365:17" alias="P">
                  <expression locator="365:8-365:15" name="ProcList" xsi:type="OperandRef"/>
               </source>
               <sort locator="365:19-368:45">
                  <by locator="365:27-368:45" direction="asc" xsi:type="ByExpression">
                     <expression locator="365:27-368:45" xsi:type="Coalesce">
                        <operand locator="366:5-366:38" path="value" xsi:type="Property">
                           <source locator="366:5-366:32" strict="false" xsi:type="As">
                              <operand locator="366:6-366:14" name="performed" xsi:type="IdentifierRef"/>
                              <asTypeSpecifier locator="366:19-366:31" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                           </source>
                        </operand>
                        <operand locator="367:5-367:42" path="value" xsi:type="Property">
                           <source locator="367:5-367:36" path="end" xsi:type="Property">
                              <source locator="367:5-367:30" strict="false" xsi:type="As">
                                 <operand locator="367:6-367:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="367:19-367:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                        <operand locator="368:5-368:44" path="value" xsi:type="Property">
                           <source locator="368:5-368:38" path="start" xsi:type="Property">
                              <source locator="368:5-368:30" strict="false" xsi:type="As">
                                 <operand locator="368:6-368:14" name="performed" xsi:type="IdentifierRef"/>
                                 <asTypeSpecifier locator="368:19-368:29" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                              </source>
                           </source>
                        </operand>
                     </expression>
                  </by>
               </sort>
            </source>
         </expression>
         <operand name="ProcList">
            <operandTypeSpecifier locator="364:46-364:60" xsi:type="ListTypeSpecifier">
               <elementType locator="364:51-364:59" name="fhir:Procedure" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="383:1-385:55" name="ServiceRequestActiveOrCompleted" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="384:3-385:55" xsi:type="Query">
            <source locator="384:3-384:22" alias="S">
               <expression locator="384:3-384:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="385:5-385:55" xsi:type="In">
               <operand locator="385:11-385:24" path="value" xsi:type="Property">
                  <source locator="385:11-385:18" path="status" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="385:29-385:55" xsi:type="List">
                  <element locator="385:34-385:41" valueType="t:String" value="active" xsi:type="Literal"/>
                  <element locator="385:44-385:54" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="383:68-383:87" xsi:type="ListTypeSpecifier">
               <elementType locator="383:73-383:86" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="396:1-398:65" name="ServiceRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="397:3-398:65" xsi:type="Query">
            <source locator="397:3-397:22" alias="S">
               <expression locator="397:3-397:20" name="ServiceRequestList" xsi:type="OperandRef"/>
            </source>
            <where locator="398:5-398:65" xsi:type="In">
               <operand locator="398:11-398:28" path="value" xsi:type="Property">
                  <source locator="398:11-398:22" path="authoredOn" scope="S" xsi:type="Property"/>
               </operand>
               <operand locator="398:33-398:65" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="398:42-398:57" xsi:type="Subtract">
                     <operand locator="398:42-398:46" xsi:type="Now"/>
                     <operand locator="398:50-398:57" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="398:60-398:64" xsi:type="Now"/>
               </operand>
            </where>
         </expression>
         <operand name="ServiceRequestList">
            <operandTypeSpecifier locator="396:59-396:78" xsi:type="ListTypeSpecifier">
               <elementType locator="396:64-396:77" name="fhir:ServiceRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="396:90-396:104" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="419:1-420:99" name="MedicationRequestsByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="420:3-420:99" xsi:type="Query">
            <source locator="420:3-420:23" alias="M">
               <expression locator="420:3-420:21" dataType="fhir:MedicationRequest" templateId="http://hl7.org/fhir/StructureDefinition/MedicationRequest" xsi:type="Retrieve"/>
            </source>
            <where locator="420:25-420:99" xsi:type="Equivalent">
               <operand locator="420:31-420:89" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="420:53-420:88" strict="false" xsi:type="As">
                     <operand locator="420:53-420:64" path="medication" scope="M" xsi:type="Property"/>
                     <asTypeSpecifier locator="420:69-420:88" name="fhir:CodeableConcept" xsi:type="NamedTypeSpecifier"/>
                  </operand>
               </operand>
               <operand locator="420:93-420:99" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="419:53-419:66" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="432:1-436:80" name="ActiveMedicationStatement" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="433:3-436:80" xsi:type="Query">
            <source locator="433:3-433:11" alias="M">
               <expression locator="433:3-433:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <let locator="434:9-434:69" identifier="EffectivePeriod">
               <expression locator="434:26-434:69" name="PeriodToInterval" xsi:type="FunctionRef">
                  <operand locator="434:43-434:68" strict="false" xsi:type="As">
                     <operand locator="434:43-434:53" path="effective" scope="M" xsi:type="Property"/>
                     <asTypeSpecifier locator="434:58-434:68" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                  </operand>
               </expression>
            </let>
            <where locator="435:5-436:80" xsi:type="And">
               <operand locator="435:11-435:35" xsi:type="Equal">
                  <operand locator="435:11-435:24" path="value" xsi:type="Property">
                     <source locator="435:11-435:18" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="435:28-435:35" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand locator="436:11-436:80" xsi:type="Or">
                  <operand locator="436:12-436:41" xsi:type="IsNull">
                     <operand locator="436:12-436:33" xsi:type="End">
                        <operand locator="436:19-436:33" name="EffectivePeriod" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="436:46-436:79" xsi:type="After">
                     <operand locator="436:46-436:67" xsi:type="End">
                        <operand locator="436:53-436:67" name="EffectivePeriod" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="436:75-436:79" xsi:type="Now"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="432:51-432:75" xsi:type="ListTypeSpecifier">
               <elementType locator="432:56-432:74" name="fhir:MedicationStatement" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="453:1-454:43" name="ActiveMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="454:3-454:43" xsi:type="Query">
            <source locator="454:3-454:11" alias="M">
               <expression locator="454:3-454:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="454:13-454:43" xsi:type="Equal">
               <operand locator="454:19-454:32" path="value" xsi:type="Property">
                  <source locator="454:19-454:26" path="status" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="454:36-454:43" valueType="t:String" value="active" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="453:49-453:71" xsi:type="ListTypeSpecifier">
               <elementType locator="453:54-453:70" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="464:1-467:37" name="ActiveOrCompletedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="465:3-467:37" xsi:type="Query">
            <source locator="465:3-465:11" alias="M">
               <expression locator="465:3-465:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="466:5-467:37" xsi:type="Or">
               <operand locator="466:11-466:35" xsi:type="Equal">
                  <operand locator="466:11-466:24" path="value" xsi:type="Property">
                     <source locator="466:11-466:18" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="466:28-466:35" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand locator="467:10-467:37" xsi:type="Equal">
                  <operand locator="467:10-467:23" path="value" xsi:type="Property">
                     <source locator="467:10-467:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="467:27-467:37" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="464:60-464:82" xsi:type="ListTypeSpecifier">
               <elementType locator="464:65-464:81" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="480:1-483:37" name="ActiveOrCompletedMedicationStatement" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="481:3-483:37" xsi:type="Query">
            <source locator="481:3-481:11" alias="M">
               <expression locator="481:3-481:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="482:5-483:37" xsi:type="Or">
               <operand locator="482:11-482:35" xsi:type="Equal">
                  <operand locator="482:11-482:24" path="value" xsi:type="Property">
                     <source locator="482:11-482:18" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="482:28-482:35" valueType="t:String" value="active" xsi:type="Literal"/>
               </operand>
               <operand locator="483:10-483:37" xsi:type="Equal">
                  <operand locator="483:10-483:23" path="value" xsi:type="Property">
                     <source locator="483:10-483:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="483:27-483:37" valueType="t:String" value="completed" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="480:62-480:86" xsi:type="ListTypeSpecifier">
               <elementType locator="480:67-480:85" name="fhir:MedicationStatement" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="493:1-497:35" name="ActiveCompletedOrStoppedMedicationRequest" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="494:3-497:35" xsi:type="Query">
            <source locator="494:3-494:11" alias="M">
               <expression locator="494:3-494:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <where locator="495:5-497:35" xsi:type="Or">
               <operand locator="495:11-496:37" xsi:type="Or">
                  <operand locator="495:11-495:35" xsi:type="Equal">
                     <operand locator="495:11-495:24" path="value" xsi:type="Property">
                        <source locator="495:11-495:18" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="495:28-495:35" valueType="t:String" value="active" xsi:type="Literal"/>
                  </operand>
                  <operand locator="496:10-496:37" xsi:type="Equal">
                     <operand locator="496:10-496:23" path="value" xsi:type="Property">
                        <source locator="496:10-496:17" path="status" scope="M" xsi:type="Property"/>
                     </operand>
                     <operand locator="496:27-496:37" valueType="t:String" value="completed" xsi:type="Literal"/>
                  </operand>
               </operand>
               <operand locator="497:10-497:35" xsi:type="Equal">
                  <operand locator="497:10-497:23" path="value" xsi:type="Property">
                     <source locator="497:10-497:17" path="status" scope="M" xsi:type="Property"/>
                  </operand>
                  <operand locator="497:27-497:35" valueType="t:String" value="stopped" xsi:type="Literal"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="493:67-493:89" xsi:type="ListTypeSpecifier">
               <elementType locator="493:72-493:88" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="507:1-510:48" name="MedicationRequestLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="508:3-510:48" xsi:type="Query">
            <source locator="508:3-508:11" alias="M">
               <expression locator="508:3-508:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <let locator="509:9-509:59" identifier="LookBackInterval">
               <expression locator="509:27-509:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="509:36-509:51" xsi:type="Subtract">
                     <operand locator="509:36-509:40" xsi:type="Now"/>
                     <operand locator="509:44-509:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="509:54-509:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="510:5-510:48" xsi:type="In">
               <operand locator="510:11-510:28" path="value" xsi:type="Property">
                  <source locator="510:11-510:22" path="authoredOn" scope="M" xsi:type="Property"/>
               </operand>
               <operand locator="510:33-510:48" name="LookBackInterval" xsi:type="QueryLetRef"/>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="507:51-507:73" xsi:type="ListTypeSpecifier">
               <elementType locator="507:56-507:72" name="fhir:MedicationRequest" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="507:85-507:99" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="521:1-525:79" name="MedicationStatementLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="522:3-525:79" xsi:type="Query">
            <source locator="522:3-522:11" alias="M">
               <expression locator="522:3-522:9" name="MedList" xsi:type="OperandRef"/>
            </source>
            <let locator="523:9-523:59" identifier="LookBackInterval">
               <expression locator="523:27-523:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="523:36-523:51" xsi:type="Subtract">
                     <operand locator="523:36-523:40" xsi:type="Now"/>
                     <operand locator="523:44-523:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="523:54-523:58" xsi:type="Now"/>
               </expression>
            </let>
            <where locator="524:5-525:79" xsi:type="Or">
               <operand locator="524:11-524:66" xsi:type="In">
                  <operand locator="524:11-524:46" path="value" xsi:type="Property">
                     <source locator="524:11-524:40" strict="false" xsi:type="As">
                        <operand locator="524:12-524:22" path="effective" scope="M" xsi:type="Property"/>
                        <asTypeSpecifier locator="524:27-524:39" name="fhir:dateTime" xsi:type="NamedTypeSpecifier"/>
                     </source>
                  </operand>
                  <operand locator="524:51-524:66" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
               <operand locator="525:10-525:79" xsi:type="Overlaps">
                  <operand locator="525:10-525:53" name="PeriodToInterval" xsi:type="FunctionRef">
                     <operand locator="525:27-525:52" strict="false" xsi:type="As">
                        <operand locator="525:27-525:37" path="effective" scope="M" xsi:type="Property"/>
                        <asTypeSpecifier locator="525:42-525:52" name="fhir:Period" xsi:type="NamedTypeSpecifier"/>
                     </operand>
                  </operand>
                  <operand locator="525:64-525:79" name="LookBackInterval" xsi:type="QueryLetRef"/>
               </operand>
            </where>
         </expression>
         <operand name="MedList">
            <operandTypeSpecifier locator="521:53-521:77" xsi:type="ListTypeSpecifier">
               <elementType locator="521:58-521:76" name="fhir:MedicationStatement" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="521:89-521:103" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="535:1-536:85" name="EncountersByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="536:3-536:85" xsi:type="Query">
            <source locator="536:3-536:15" alias="E">
               <expression locator="536:3-536:13" dataType="fhir:Encounter" templateId="http://hl7.org/fhir/StructureDefinition/Encounter" xsi:type="Retrieve"/>
            </source>
            <where locator="536:17-536:85" xsi:type="Exists">
               <operand locator="536:29-536:85" xsi:type="Query">
                  <source locator="536:31-536:41" alias="ET">
                     <expression locator="536:31-536:38" path="type" scope="E" xsi:type="Property"/>
                  </source>
                  <where locator="536:43-536:83" xsi:type="Equivalent">
                     <operand locator="536:49-536:73" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="536:71-536:72" name="ET" xsi:type="AliasRef"/>
                     </operand>
                     <operand locator="536:77-536:83" name="Koncept" xsi:type="OperandRef"/>
                  </where>
               </operand>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="535:45-535:58" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="544:1-546:40" name="InProgress" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="545:3-546:40" xsi:type="Query">
            <source locator="545:3-545:11" alias="E">
               <expression locator="545:3-545:9" name="EncList" xsi:type="OperandRef"/>
            </source>
            <where locator="546:5-546:40" xsi:type="Equal">
               <operand locator="546:11-546:24" path="value" xsi:type="Property">
                  <source locator="546:11-546:18" path="status" scope="E" xsi:type="Property"/>
               </operand>
               <operand locator="546:28-546:40" valueType="t:String" value="in-progress" xsi:type="Literal"/>
            </where>
         </expression>
         <operand name="EncList">
            <operandTypeSpecifier locator="544:36-544:50" xsi:type="ListTypeSpecifier">
               <elementType locator="544:41-544:49" name="fhir:Encounter" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="556:1-557:70" name="AllergyIntolerancesByConcept" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="557:3-557:70" xsi:type="Query">
            <source locator="557:3-557:24" alias="A">
               <expression locator="557:3-557:22" dataType="fhir:AllergyIntolerance" templateId="http://hl7.org/fhir/StructureDefinition/AllergyIntolerance" xsi:type="Retrieve"/>
            </source>
            <where locator="557:26-557:70" xsi:type="Equivalent">
               <operand locator="557:32-557:60" name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                  <operand locator="557:54-557:59" path="code" scope="A" xsi:type="Property"/>
               </operand>
               <operand locator="557:64-557:70" name="Koncept" xsi:type="OperandRef"/>
            </where>
         </expression>
         <operand name="Koncept">
            <operandTypeSpecifier locator="556:54-556:67" name="t:Concept" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
      <def locator="567:1-570:67" name="ActiveOrConfirmedAllergyIntolerance" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="568:3-570:67" xsi:type="Query">
            <source locator="568:3-568:20" alias="A">
               <expression locator="568:3-568:18" name="AllergyIntolList" xsi:type="OperandRef"/>
            </source>
            <where locator="569:5-570:67" xsi:type="Or">
               <operand locator="569:11-569:61" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="569:11-569:26" path="clinicalStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="569:30-569:61" name="AllergyIntolerance Active code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
               <operand locator="570:10-570:67" xsi:type="Equivalent">
                  <operand name="ToConcept" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                     <operand locator="570:10-570:29" path="verificationStatus" scope="A" xsi:type="Property"/>
                  </operand>
                  <operand xsi:type="ToConcept">
                     <operand locator="570:33-570:67" name="AllergyIntolerance Confirmed code" xsi:type="CodeRef"/>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="AllergyIntolList">
            <operandTypeSpecifier locator="567:70-567:93" xsi:type="ListTypeSpecifier">
               <elementType locator="567:75-567:92" name="fhir:AllergyIntolerance" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
      </def>
      <def locator="582:1-592:79" name="GoalLookBack" context="Patient" accessLevel="Public" xsi:type="FunctionDef">
         <expression locator="583:3-592:79" xsi:type="Query">
            <source locator="583:3-583:12" alias="G">
               <expression locator="583:3-583:10" name="GoalList" xsi:type="OperandRef"/>
            </source>
            <let locator="584:9-584:59" identifier="LookBackInterval">
               <expression locator="584:27-584:59" lowClosed="true" highClosed="true" xsi:type="Interval">
                  <low locator="584:36-584:51" xsi:type="Subtract">
                     <operand locator="584:36-584:40" xsi:type="Now"/>
                     <operand locator="584:44-584:51" name="LookBack" xsi:type="OperandRef"/>
                  </low>
                  <high locator="584:54-584:58" xsi:type="Now"/>
               </expression>
            </let>
            <let locator="585:5-585:43" identifier="StartDate">
               <expression locator="585:16-585:43" path="value" xsi:type="Property">
                  <source locator="585:16-585:37" strict="false" xsi:type="As">
                     <operand locator="585:17-585:23" path="start" scope="G" xsi:type="Property"/>
                     <asTypeSpecifier locator="585:28-585:36" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                  </source>
               </expression>
            </let>
            <let locator="586:5-586:34" identifier="StatusDate">
               <expression locator="586:17-586:34" path="value" xsi:type="Property">
                  <source locator="586:17-586:28" path="statusDate" scope="G" xsi:type="Property"/>
               </expression>
            </let>
            <let locator="587:5-587:63" identifier="TargetDates">
               <expression locator="587:18-587:63" xsi:type="Query">
                  <source locator="587:18-587:29" alias="T">
                     <expression locator="587:18-587:27" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="587:31-587:63">
                     <expression locator="587:38-587:63" path="value" xsi:type="Property">
                        <source locator="587:38-587:57" strict="false" xsi:type="As">
                           <operand locator="587:39-587:43" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="587:48-587:56" name="fhir:date" xsi:type="NamedTypeSpecifier"/>
                        </source>
                     </expression>
                  </return>
               </expression>
            </let>
            <let locator="588:5-588:88" identifier="TargetQuantities">
               <expression locator="588:23-588:88" xsi:type="Query">
                  <source locator="588:23-588:34" alias="T">
                     <expression locator="588:23-588:32" path="target" scope="G" xsi:type="Property"/>
                  </source>
                  <return locator="588:36-588:88">
                     <expression locator="588:43-588:88" name="ToQuantity" libraryName="FHIRHelpers" xsi:type="FunctionRef">
                        <operand locator="588:66-588:87" strict="false" xsi:type="As">
                           <operand locator="588:66-588:70" path="due" scope="T" xsi:type="Property"/>
                           <asTypeSpecifier locator="588:75-588:87" name="fhir:Duration" xsi:type="NamedTypeSpecifier"/>
                        </operand>
                     </expression>
                  </return>
               </expression>
            </let>
            <where locator="589:5-592:79" xsi:type="Or">
               <operand locator="589:11-591:60" xsi:type="Or">
                  <operand locator="589:11-590:39" xsi:type="Or">
                     <operand locator="589:11-589:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="589:11-589:19" name="StartDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="589:24-589:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                     <operand locator="590:10-590:39" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="590:10-590:19" name="StatusDate" xsi:type="QueryLetRef"/>
                        </operand>
                        <operand locator="590:24-590:39" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </operand>
                  </operand>
                  <operand locator="591:10-591:60" xsi:type="Exists">
                     <operand locator="591:16-591:60" xsi:type="Query">
                        <source locator="591:17-591:30" alias="TD">
                           <expression locator="591:17-591:27" name="TargetDates" xsi:type="QueryLetRef"/>
                        </source>
                        <where locator="591:32-591:59" xsi:type="In">
                           <operand xsi:type="ToDateTime">
                              <operand locator="591:38-591:39" name="TD" xsi:type="AliasRef"/>
                           </operand>
                           <operand locator="591:44-591:59" name="LookBackInterval" xsi:type="QueryLetRef"/>
                        </where>
                     </operand>
                  </operand>
               </operand>
               <operand locator="592:10-592:79" xsi:type="Exists">
                  <operand locator="592:16-592:79" xsi:type="Query">
                     <source locator="592:17-592:35" alias="TQ">
                        <expression locator="592:17-592:32" name="TargetQuantities" xsi:type="QueryLetRef"/>
                     </source>
                     <where locator="592:37-592:78" xsi:type="In">
                        <operand xsi:type="ToDateTime">
                           <operand locator="592:43-592:58" xsi:type="Add">
                              <operand locator="592:44-592:52" name="StartDate" xsi:type="QueryLetRef"/>
                              <operand locator="592:56-592:57" name="TQ" xsi:type="AliasRef"/>
                           </operand>
                        </operand>
                        <operand locator="592:63-592:78" name="LookBackInterval" xsi:type="QueryLetRef"/>
                     </where>
                  </operand>
               </operand>
            </where>
         </expression>
         <operand name="GoalList">
            <operandTypeSpecifier locator="582:39-582:48" xsi:type="ListTypeSpecifier">
               <elementType locator="582:44-582:47" name="fhir:Goal" xsi:type="NamedTypeSpecifier"/>
            </operandTypeSpecifier>
         </operand>
         <operand name="LookBack">
            <operandTypeSpecifier locator="582:60-582:74" name="t:Quantity" xsi:type="NamedTypeSpecifier"/>
         </operand>
      </def>
   </statements>
</library>
